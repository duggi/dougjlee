<html><head></head><body>/* ****************************************************************** * Popup Calendar * * author : Tan Ling Wee on 2 Dec 2001 * email : fuushikaden@yahoo.com * * modified : Douglas Lee added css and fixed up functions $Id: popcalendar_3pc.js,v 1.6 2002/10/18 21:33:43 doug Exp $ * changed input to accept three fields * kludged in year upper and lower clamps * */ // ****************************************************************** // script globals // -------------------------- // var fixedX = -1 // x position (-1 if to appear below control) var fixedY = -1 // y position (-1 if to appear below control) var startAt = 0 // 0 - sunday ; 1 - monday var showWeekNumber = 0 // 0 - don't show; 1 - show var showToday = 1 // 0 - don't show; 1 - show var imgDir = &quot;/merced/ccimages/&quot; // directory for images. ex: var imgDir=&quot;/img/&quot; var gotoString = &quot;Go To Current Month&quot; var todayString = &quot;Go To Today's Date: &quot; var weekString = &quot;Wk&quot; var scrollLeftMessage = &quot;Click to scroll to previous month. Hold mouse button to scroll automatically.&quot; var scrollRightMessage = &quot;Click to scroll to next month. Hold mouse button to scroll automatically.&quot; var selectMonthMessage = &quot;Click to select a month.&quot; var selectYearMessage = &quot;Click to select a year.&quot; var selectDateMessage = &quot;Select [date] as date.&quot; // ** do not replace [date], it will be replaced by date var crossobj, crossMonthObj, crossYearObj, monthSelected, yearSelected, dateSelected, omonthSelected, oyearSelected, odateSelected, monthConstructed, yearConstructed, intervalID1, intervalID2, timeoutID1, timeoutID2, ctlToPlaceMonthValue, ctlToPlaceDateValue, ctlToPlaceYearValue, ctlNow, dateFormat, nStartingYear var bPageLoaded=false var ie=document.all var dom=document.getElementById var ns4=document.layers var today = new Date() var dateNow = today.getDate() var monthNow = today.getMonth() var yearNow = today.getYear() var imgsrc = new Array(&quot;popcal-drop1.gif&quot;,&quot;popcal-drop2.gif&quot;,&quot;popcal-left1.gif&quot;,&quot;popcal-left2.gif&quot;,&quot;popcal-right1.gif&quot;,&quot;popcal-right2.gif&quot;) var img = new Array() var bShow = false; // ****************************************************************** // hideElement // -------------------------- // hides <select> and <applet> objects (for IE only) // function hideElement( elmID, overDiv ) { if( ie ) { for( i = 0; i &lt; document.all.tags( elmID ).length; i++ ) { obj = document.all.tags( elmID )[i]; if( !obj || !obj.offsetParent ) { continue; } // Find the element's offsetTop and offsetLeft relative to the BODY tag. objLeft = obj.offsetLeft; objTop = obj.offsetTop; objParent = obj.offsetParent; while( objParent.tagName.toUpperCase() != &quot;BODY&quot; ) { objLeft += objParent.offsetLeft; objTop += objParent.offsetTop; objParent = objParent.offsetParent; } objHeight = obj.offsetHeight; objWidth = obj.offsetWidth; if(( overDiv.offsetLeft + overDiv.offsetWidth ) &lt;= objLeft ); else if(( overDiv.offsetTop + overDiv.offsetHeight ) &lt;= objTop ); else if( overDiv.offsetTop &gt;= ( objTop + objHeight )); else if( overDiv.offsetLeft &gt;= ( objLeft + objWidth )); else { obj.style.visibility = &quot;hidden&quot;; } } } } // ****************************************************************** // showElement // -------------------------- // unhides <select> and <applet> objects (for IE only) // function showElement( elmID ) { if( ie ) { for( i = 0; i &lt; document.all.tags( elmID ).length; i++ ) { obj = document.all.tags( elmID )[i]; if( !obj || !obj.offsetParent ) { continue; } obj.style.visibility = &quot;&quot;; } } } // ****************************************************************** // HolidayRec // -------------------------- // function HolidayRec (d, m, y, desc) { this.d = d this.m = m this.y = y this.desc = desc } // ****************************************************************** // addHoliday // -------------------------- // var HolidaysCounter = 0 var Holidays = new Array() function addHoliday (d, m, y, desc) { Holidays[HolidaysCounter++] = new HolidayRec ( d, m, y, desc ) } // ****************************************************************** // write calendar table // -------------------------- if (dom) { // preload images for (i=0;i&quot; } // title-control table sHTML1 = &quot;<table border=0 cellpadding=0 cellspacing=2 width=150><tr><td>&quot; // left arrow sHTML1 += &quot;</td><td "="&quot;" +="      title='" +scrollleftmessage+"'="+scrollLeftMessage+&quot;'" changeleft\",\"popcal-left1.gif\");"="changeLeft\&quot;,\&quot;popcal-left1.gif\&quot;);&quot;" changeleft\",\"popcal-left2.gif\");"="changeLeft\&quot;,\&quot;popcal-left2.gif\&quot;);&quot;" class="title-control-normal-style" shtml1="sHTML1" startdecmonth()\",300)'"="StartDecMonth()\&quot;,300)'&quot;" title-control-normal-style\";'"="title-control-normal-style\&quot;;'&quot;" title-control-select-style\";'"="title-control-select-style\&quot;;'&quot;">&quot; sHTML1 += &quot; <img "="&quot;" +="      title='" +selectmonthmessage+"'="+selectMonthMessage+&quot;'" //="//" changemonth\",\"popcal-drop1.gif\");"="changeMonth\&quot;,\&quot;popcal-drop1.gif\&quot;);&quot;" changemonth\",\"popcal-drop2.gif\");"="changeMonth\&quot;,\&quot;popcal-drop2.gif\&quot;);&quot;" id="changeLeft" month="month" popdownmonth()\",300);"="popDownMonth()\&quot;,300);&quot;" pulldown="pulldown" shtml1="sHTML1" src="merced--forms--jslib--%22+imgDir+%22popcal-left1.gif" title-control-normal-style\";'"="title-control-normal-style\&quot;;'&quot;" title-control-select-style\";'"="title-control-select-style\&quot;;'&quot;">&quot; sHTML1 += &quot;</td><td>&quot; // year pulldown sHTML1 += &quot;</td><td "="&quot;" +="      title='" +selectmonthmessage+"'="+selectMonthMessage+&quot;'" changeyear\",\"popcal-drop1.gif\");"="changeYear\&quot;,\&quot;popcal-drop1.gif\&quot;);&quot;" changeyear\",\"popcal-drop2.gif\");"="changeYear\&quot;,\&quot;popcal-drop2.gif\&quot;);&quot;" class="title-control-normal-style" popdownyear()\",300);"="popDownYear()\&quot;,300);&quot;" shtml1="sHTML1" title-control-normal-style\";'"="title-control-normal-style\&quot;;'&quot;" title-control-select-style\";'"="title-control-select-style\&quot;;'&quot;" width="50%">&quot; sHTML1 += &quot;</td><td>&quot; // right arrow sHTML1 += &quot;</td><td "="&quot;" +="      title='" +scrollrightmessage+"'="+scrollRightMessage+&quot;'" changeright\",\"popcal-right1.gif\");"="changeRight\&quot;,\&quot;popcal-right1.gif\&quot;);&quot;" changeright\",\"popcal-right2.gif\");"="changeRight\&quot;,\&quot;popcal-right2.gif\&quot;);&quot;" class="title-control-normal-style" shtml1="sHTML1" startincmonth()\",300)'"="StartIncMonth()\&quot;,300)'&quot;" title-control-normal-style\";'"="title-control-normal-style\&quot;;'&quot;" title-control-select-style\";'"="title-control-select-style\&quot;;'&quot;">&quot; sHTML1 += &quot; <img !="null){crossYearObj.visibility=&quot;hidden&quot;}" "="&quot;" '0'="'0'" 'applet'="'APPLET'" 'select'="'SELECT'" ("dd","<e="(&quot;dd&quot;,&quot;&lt;e" (crossmonthobj="(crossMonthObj" (crossyearobj="(crossYearObj" (num="(num" );=");" ******************************************************************="******************************************************************" +="+" --------------------------="--------------------------" //="//" 10)?="10)?" :=":" ;=";" <="&lt;" bpageloaded="true" constructdate="constructDate" constructdate(d,m,y)="constructDate(d,m,y)" crossobj.visibility="hidden" document.getelementbyid("caption").innerhtml="sHTML1" function="function" hidecalendar="hideCalendar" hidecalendar()="hideCalendar()" id="changeRight" if="if" num="num" padzero="padZero" padzero(num)="padZero(num)" return="return" showelement(="showElement(" shtml1="sHTML1" src="merced--forms--jslib--%22+imgDir+%22popcal-right1.gif" stmp="sTmp.replace" {="{" }="}">&quot;) sTmp = sTmp.replace (&quot;d&quot;,&quot;&quot;) sTmp = sTmp.replace (&quot;&quot;,padZero(d)) sTmp = sTmp.replace (&quot;&quot;,d) sTmp = sTmp.replace (&quot;mmm&quot;,&quot;&quot;) sTmp = sTmp.replace (&quot;mm&quot;,&quot;&quot;) sTmp = sTmp.replace (&quot;m&quot;,&quot;&quot;) sTmp = sTmp.replace (&quot;&quot;,m+1) sTmp = sTmp.replace (&quot;&quot;,padZero(m+1)) sTmp = sTmp.replace (&quot;&quot;,monthName[m]) return sTmp.replace (&quot;yyyy&quot;,y) } // ****************************************************************** // closeCalendar // -------------------------- // function closeCalendar() { var sTmp hideCalendar(); ctlToPlaceMonthValue.value = monthSelected+1 ctlToPlaceDateValue.value = dateSelected ctlToPlaceYearValue.value = yearSelected } // ****************************************************************** // Month Functions // // ************************** // StartDecMonth // -------------------------- // function StartDecMonth() { intervalID1=setInterval(&quot;decMonth()&quot;,80) // do not set to 0 or it wont auto-scroll } // ************************** // StartIncMonth // -------------------------- // function StartIncMonth() { intervalID1=setInterval(&quot;incMonth()&quot;,80) // do not set to 0 or it wont auto-scroll } // ************************** // incMonth // -------------------------- // function incMonth() { monthSelected++ if (monthSelected&gt;11) { monthSelected=0 yearSelected++ } constructCalendar() } // ************************** // decMonth // -------------------------- // function decMonth() { monthSelected-- if (monthSelected&lt;0) { monthSelected=11 yearSelected-- } constructCalendar() } // ************************** // constructMonth // -------------------------- // function constructMonth() { popDownYear() if (!monthConstructed) { sHTML = &quot;&quot; for (i=0; i&lt;12; i++) { sName = monthName[i]; sHTML += &quot;</td></tr><tr><td "="&quot;" "</b="&quot;&lt;/B" (i="=monthSelected)" +="+" //="//" css="css" get="get" id="m&quot; + i + &quot;" if="if" monthselected="monthSelected" sname="sName" {="{">&quot; sHTML += &quot; class='dropdown-select-style'&quot; } else if (i!=monthSelected) { sHTML += &quot; onmouseover='&quot; sHTML += &quot; this.className=\&quot;dropdown-select-style\&quot;'&quot; sHTML += &quot; onmouseout='&quot; sHTML += &quot; this.className=\&quot;dropdown-normal-style\&quot;'&quot; } // pass value sHTML += &quot; onclick='&quot; sHTML += &quot; monthConstructed=false;&quot; sHTML += &quot; monthSelected=&quot; + i + &quot;;&quot; sHTML += &quot; constructCalendar();&quot; sHTML += &quot; popDownMonth();&quot; sHTML += &quot; event.cancelBubble=true'&gt;&nbsp;&quot; + sName + &quot;&nbsp;&quot; sHTML += &quot;</td></tr><tr><td>&quot; } iHTML = &quot;<table "'"="&quot;'&quot;" "</b="&quot;&lt;/B" "show"="&quot;show&quot;" "visible"="&quot;visible&quot;" 'applet',="'APPLET'," 'select',="'SELECT'," (!yearconstructed)="(!yearConstructed)" (i="=yearSelected)" );=");" **************************="**************************" ******************************************************************="******************************************************************" +="+" --------------------------="--------------------------" //="//" //for="//for" //yearselected="parseInt(nYear+nStartingYear);" 26=26 :=":" cellpadding="1&quot;" cellspacing=1 clamping="clamping" class="dropdown-style" constructcalendar();="constructCalendar();" constructmonth()="constructMonth()" constructyear="constructYear" constructyear()="constructYear()" crossmonthobj.left="parseInt(crossobj.left)" crossmonthobj.top="parseInt(crossobj.top)" crossmonthobj.visibility="hidden" css="css" deprecated="deprecated" document.getelementbyid("selectmonth")="document.getElementById(&quot;selectMonth&quot;)" document.getelementbyid("selectmonth").innerhtml="iHTML" for="for" function="function" functions="Functions" give="give" hideelement(="hideElement(" how="how" i++)="i++)" i<="2005;" if="if" ihtml="iHTML" in="in" j="j" kludged="kludged" many="many" monthconstructed="true" nstartingyear="yearSelected-3" offset="offset" popdownmonth="popDownMonth" popdownmonth()="popDownMonth()" popdownmonth()\",300);"="popDownMonth()\&quot;,300);&quot;" popdownyear();="popDownYear();" popupmonth="popUpMonth" popupmonth()="popUpMonth()" pulldown="pulldown" selectyear="selectYear" selectyear(nyear)="selectYear(nYear)" shtml="sHTML" sname="sName" to="to" width=60 with="with" year="year" yearconstructed="false;" years="years" yearselected="yearSelected" {="{" }="}"><tr><td>&quot; sHTML += &quot; class='dropdown-select-style'&quot; } else if (i != yearSelected){ sHTML += &quot; onmouseover='&quot; sHTML += &quot; this.className=\&quot;dropdown-select-style\&quot;'&quot; sHTML += &quot; onmouseout='&quot; sHTML += &quot; this.className=\&quot;dropdown-normal-style\&quot;'&quot; } // pass value sHTML += &quot; onclick='&quot; sHTML += &quot; selectYear(&quot;+i+&quot;);&quot; sHTML += &quot; event.cancelBubble=true'&gt;&quot; sHTML += &quot;&nbsp;&quot; + sName + &quot;&nbsp;&quot; sHTML += &quot;</td></tr><tr><td>&quot; j ++; } // year pulldown table iHTML = &quot;<table +="         timeoutID2=setTimeout(\" cellpadding="1&quot;" cellspacing=1 class="dropdown-style" ihtml="iHTML" popdownyear()\",300)'="popDownYear()\&quot;,300)'" width=60><tr><td>&quot; + sHTML iHTML +=&quot;</td></tr></table>&quot; document.getElementById(&quot;selectYear&quot;).innerHTML = iHTML yearConstructed = true } } // ************************** // popDownYear // -------------------------- // function popDownYear() { clearInterval(intervalID1) clearTimeout(timeoutID1) clearInterval(intervalID2) clearTimeout(timeoutID2) crossYearObj.visibility= &quot;hidden&quot; } // ************************** // popUpYear // -------------------------- // function popUpYear() { var leftOffset constructYear() crossYearObj.visibility = (dom||ie)? &quot;visible&quot; : &quot;show&quot; leftOffset = parseInt(crossobj.left) + document.getElementById(&quot;spanYear&quot;).offsetLeft if (ie) { leftOffset += 6 } crossYearObj.left = leftOffset + 68 crossYearObj.top = parseInt(crossobj.top) + 26 // offset pulldown } // ****************************************************************** // Calendar Functions // // ************************** // WeekNbr // -------------------------- // function WeekNbr(today) { Year = takeYear(today); Month = today.getMonth(); Day = today.getDate(); now = Date.UTC(Year,Month,Day+1,0,0,0); var Firstday = new Date(); Firstday.setYear(Year); Firstday.setMonth(0); Firstday.setDate(1); then = Date.UTC(Year,0,1,0,0,0); var Compensation = Firstday.getDay(); if (Compensation &gt; 3) Compensation -= 4; else Compensation += 3; NumberOfWeek = Math.round((((now-then)/86400000)+Compensation)/7); return NumberOfWeek; } // ************************** // takeYear // -------------------------- // function takeYear(theDate) { x = theDate.getYear(); var y = x % 100; y += (y &lt; 38) ? 2000 : 1900; return y; } // ************************** // constructCalendar // -------------------------- // function constructCalendar() { var startDate = new Date (yearSelected,monthSelected,1) var endDate = new Date (yearSelected,monthSelected+1,1); endDate = new Date (endDate - (24*60*60*1000)); numDaysInMonth = endDate.getDate() datePointer = 0 dayPointer = startDate.getDay() - startAt if (dayPointer&lt;0) { dayPointer = 6 } // calendar body sHTML = &quot;<table border=0 class="body-style"><tr><td>&quot; if (showWeekNumber==1) { sHTML += &quot;</td><td><b>&quot; + weekString + &quot;</b></td><td>&quot; sHTML += &quot;</td><td class="weeknumber-div-style" rowspan=7><img src="merced--forms--jslib--%22+imgDir+%22popcal-divider.gif" width=1></td><td>&quot; } for (i=0; i&lt;7; i++) { sHTML += &quot;</td><td align="right"><b>&quot;+ dayName[i]+&quot;</b></td><td>&quot; } sHTML +=&quot;</td></tr><tr><td>&quot; if (showWeekNumber==1) { sHTML += &quot;</td><td align="right">&quot; + WeekNbr(startDate) + &quot;&nbsp;</td><td>&quot; } for ( var i=1; i&lt;=dayPointer;i++ ) { sHTML += &quot;</td><td>&nbsp;</td><td>&quot; } // selected day logic, assign css for ( datePointer=1; datePointer&lt;=numDaysInMonth; datePointer++ ) { dayPointer++; // regular day var sStyle=&quot;normal-day-style&quot;; // today if ((datePointer==dateNow)&amp;&amp;(monthSelected==monthNow)&amp;&amp;(yearSelected==yearNow)) { sStyle = &quot;current-day-style&quot;; } // calculate weekends else if ((dayPointer + 1) % 7 == 1 || dayPointer % 7 == (startAt * -1) +1) { sStyle = &quot;end-of-weekday-style&quot;; } // selected day if ((datePointer==odateSelected) &amp;&amp; (monthSelected==omonthSelected) &amp;&amp; (yearSelected==oyearSelected)) { sStyle += &quot; selected-day-style&quot;; } // holiday tooltip sHint = &quot;&quot; for (k=0;k&quot; if ((dayPointer+startAt) % 7 == startAt) { sHTML += &quot;</td></tr><tr><td>&quot; if ((showWeekNumber==1)&amp;&amp;(datePointer&quot; } } } // print calendar document.getElementById(&quot;content&quot;).innerHTML = sHTML document.getElementById(&quot;spanMonth&quot;).innerHTML = monthName[monthSelected] + &quot;<img border=0 height=10 id="changeMonth" src="merced--forms--jslib--%22+imgDir+%22popcal-drop1.gif" width=12>&quot; document.getElementById(&quot;spanYear&quot;).innerHTML = yearSelected + &quot;<img border=0 height=10 id="changeYear" src="merced--forms--jslib--%22+imgDir+%22popcal-drop1.gif" width=12>&quot; } // ****************************************************************** // popUpCalendar // -------------------------- // function popUpCalendar(ctl, ctl2, ctl3, ctl4, format) { var leftpos=0 var toppos=0 if (bPageLoaded) { if ( crossobj.visibility == &quot;hidden&quot; ) { ctlToPlaceMonthValue = ctl2 ctlToPlaceDateValue = ctl3 ctlToPlaceYearValue = ctl4 dateFormat=format; formatChar = &quot; &quot;; aFormat = dateFormat.split(formatChar); if (aFormat.length&lt;3) { formatChar = &quot;/&quot;; aFormat = dateFormat.split(formatChar); if (aFormat.length&lt;3) { formatChar = &quot;.&quot; aFormat = dateFormat.split(formatChar) if (aFormat.length&lt;3) { formatChar = &quot;-&quot; aFormat = dateFormat.split(formatChar) if (aFormat.length&lt;3) { formatChar=&quot;&quot; // invalid date format } } } } // pass current date selections to calendar tokensChanged = 0 if ( formatChar != &quot;&quot; ) { aMonthData = ctl2.value // use user's date aDateData = ctl3.value // use user's date aYearData = ctl4.value // use user's date for (i=0;i&lt;3;i++) { if ((aFormat[i]==&quot;d&quot;) || (aFormat[i]==&quot;dd&quot;)) { dateSelected = parseInt(aDateData) tokensChanged ++ } else if ((aFormat[i]==&quot;m&quot;) || (aFormat[i]==&quot;mm&quot;)) { monthSelected = parseInt(aMonthData - 1) tokensChanged ++ } else if (aFormat[i]==&quot;yyyy&quot;) { yearSelected = parseInt(aYearData) //parseInt(aYearData[i], 10) tokensChanged ++ } else if (aFormat[i]==&quot;mmm&quot;) { for (j=0; j&lt;12; j++) { if (aMonthData[i]==monthName[j]) { monthSelected=j tokensChanged ++ } } } } } // if the date selections are bad assign current user time if ((tokensChanged!=3)||isNaN(dateSelected)||isNaN(monthSelected)||isNaN(yearSelected)||(yearSelected==&quot;&quot;)) { dateSelected = dateNow monthSelected = monthNow yearSelected = yearNow } odateSelected = dateSelected omonthSelected = monthSelected oyearSelected = yearSelected aTag = ctl do { aTag = aTag.offsetParent; leftpos += aTag.offsetLeft; toppos += aTag.offsetTop; } while(aTag.tagName!=&quot;BODY&quot;); crossobj.left = fixedX==-1 ? ctl.offsetLeft + leftpos : fixedX crossobj.top = fixedY==-1 ? ctl.offsetTop + toppos + ctl.offsetHeight + 2 : fixedY constructCalendar (1, monthSelected, yearSelected); crossobj.visibility=(dom||ie)? &quot;visible&quot; : &quot;show&quot; hideElement( 'SELECT', document.getElementById(&quot;calendar&quot;) ); hideElement( 'APPLET', document.getElementById(&quot;calendar&quot;) ); bShow = true; } } else { init() popUpCalendar(ctl, ctl2, ctl3, ctl4, format) } } // ****************************************************************** // Page Actions // -------------------------- // // hidecal1 document.onkeypress = function hidecal1 () { if (event.keyCode==27) { hideCalendar() } } // hidecal2 document.onclick = function hidecal2 () { if (!bShow) { hideCalendar() } bShow = false } // hidecal1 document.onload=init() </td></tr></table></td></tr></table></td></tr></table></applet></select></applet></select></body></html>
